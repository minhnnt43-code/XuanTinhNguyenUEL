<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·∫°o Avatar Chi·∫øn d·ªãch Xu√¢n t√¨nh nguy·ªán UEL 2026</title>
    <meta name="description" content="T·∫°o avatar chi·∫øn d·ªãch Xu√¢n T√¨nh nguy·ªán UEL 2026">

    <!-- Favicon -->
    <link rel="icon" href="images/logo.png" type="image/png">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        @font-face {
            font-family: 'UTM Avo';
            src: url('fonts/UTM%20Avo.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        @font-face {
            font-family: 'UTM Avo';
            src: url('fonts/UTM%20AvoBold.ttf') format('truetype');
            font-weight: bold;
            font-style: normal;
            font-display: swap;
        }

        body {
            font-family: 'UTM Avo', 'Montserrat', sans-serif;
        }
    </style>

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Toast Notification System -->
    <script src="js/toast.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/animations.css">

    <style>
        body {
            background: linear-gradient(135deg, #FFFDE7 0%, #FFF9C4 50%, #FFEB3B 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .avatar-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #00723F;
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
        }

        /* Counter badge cho c·∫£ desktop */
        .counter-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #00723F, #00a758);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(0, 114, 63, 0.3);
        }

        .counter-badge i {
            font-size: 1.1rem;
        }

        /* Two column layout */
        .two-column {
            display: flex;
            gap: 20px;
        }

        .left-col {
            flex: 1;
            min-width: 300px;
        }

        .right-col {
            flex: 1;
            min-width: 300px;
        }

        /* Upload area styling */
        .upload-label {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px;
            border: 3px dashed #00723F;
            border-radius: 12px;
            background: rgba(0, 114, 63, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 150px;
        }

        .upload-label:hover,
        .upload-label.dragging {
            background: rgba(0, 114, 63, 0.1);
            border-color: #00a758;
        }

        .upload-label i {
            font-size: 3rem;
            color: #00723F;
            margin-bottom: 10px;
        }

        .upload-label p {
            color: #00723F;
            font-weight: 600;
            margin: 0;
        }

        .upload-label small {
            color: #666;
            margin-top: 5px;
        }

        #avatar-upload {
            display: none;
        }

        /* Canvas wrapper */
        .canvas-wrapper {
            text-align: center;
            margin-bottom: 15px;
        }

        #avatar-canvas {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        /* Tip box */
        .tip-box {
            background: rgba(0, 114, 63, 0.1);
            border-left: 4px solid #00723F;
            padding: 12px 15px;
            border-radius: 0 8px 8px 0;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #333;
        }

        .tip-box i {
            color: #FFEB3B;
            margin-right: 8px;
        }

        /* ============================================
           MOBILE RESPONSIVE STYLES
           ============================================ */
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }

            .header h1 {
                font-size: 1.2rem;
                line-height: 1.4;
            }

            .header p {
                font-size: 0.85rem;
            }

            .counter-badge {
                padding: 8px 16px;
                font-size: 0.85rem;
                margin-top: 10px;
            }

            /* Stack columns on mobile */
            .two-column {
                flex-direction: column;
                gap: 15px;
            }

            .left-col,
            .right-col {
                min-width: 100%;
            }

            /* Card styling */
            .card {
                padding: 15px !important;
                border-radius: 12px;
            }

            .card h3 {
                font-size: 1rem;
                margin-bottom: 12px;
            }

            /* Upload area mobile */
            .upload-label {
                padding: 25px 15px;
                min-height: 120px;
            }

            .upload-label i {
                font-size: 2.5rem;
            }

            .upload-label p {
                font-size: 0.95rem;
            }

            /* Canvas mobile */
            .canvas-wrapper {
                margin-bottom: 12px;
            }

            #avatar-canvas {
                max-width: 100%;
                height: auto;
                touch-action: none;
            }

            /* Zoom controls mobile */
            .zoom-controls {
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .zoom-btn {
                width: 50px !important;
                height: 50px !important;
                font-size: 1.5rem !important;
                border-radius: 12px;
                touch-action: manipulation;
            }

            .zoom-slider {
                height: 50px !important;
                -webkit-appearance: none;
                appearance: none;
            }

            /* Buttons mobile - larger touch targets */
            .btn-block {
                padding: 16px 20px !important;
                font-size: 1.1rem !important;
                border-radius: 12px;
                min-height: 56px;
            }

            /* Tip box mobile */
            .tip-box {
                font-size: 0.85rem;
                padding: 10px 12px;
            }

            /* Footer mobile */
            footer {
                margin: 20px 10px !important;
                padding: 15px !important;
                font-size: 0.8rem !important;
            }
        }

        /* Extra small screens */
        @media (max-width: 380px) {
            .header h1 {
                font-size: 1rem;
            }

            .counter-badge {
                font-size: 0.75rem;
                padding: 6px 12px;
            }

            .upload-label {
                padding: 20px 10px;
            }

            .zoom-btn {
                width: 44px !important;
                height: 44px !important;
                font-size: 1.3rem !important;
            }

            .btn-block {
                font-size: 1rem !important;
            }
        }
    </style>
</head>

<body>
    <div class="avatar-container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fa-solid fa-image"></i> T·∫°o Avatar Xu√¢n t√¨nh nguy·ªán UEL 2026</h1>
            <p>T·∫£i ·∫£nh ch√¢n dung l√™n, ƒëi·ªÅu ch·ªânh v√† t·∫£i v·ªÅ avatar chi·∫øn d·ªãch!</p>
            <div class="counter-badge" id="avatar-counter">
                <i class="fa-solid fa-download"></i>
                <span id="counter-number">0</span> avatar ƒë√£ ƒë∆∞·ª£c t·∫°o
            </div>
        </div>

        <!-- Main content -->
        <div class="two-column">
            <!-- C·ªôt ƒëi·ªÅu khi·ªÉn -->
            <div class="left-col">
                <div class="card">
                    <h3><i class="fa-solid fa-upload"></i> 1. T·∫£i ·∫£nh l√™n</h3>
                    <div id="avatar-upload-area">
                        <!-- Desktop: Label for drag/drop -->
                        <label for="avatar-upload" class="upload-label" id="avatar-upload-label">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                            <p>Nh·∫•n ho·∫∑c k√©o ·∫£nh v√†o ƒë√¢y</p>
                            <small>H·ªó tr·ª£: JPG, PNG, WEBP</small>
                        </label>
                        <!-- Mobile: Native file input -->
                        <input type="file" id="avatar-upload" accept="image/*">
                        <p id="avatar-upload-status"></p>
                    </div>
                </div>

                <div class="card" style="margin-top: 15px;">
                    <h3><i class="fa-solid fa-sliders"></i> 2. ƒêi·ªÅu ch·ªânh</h3>
                    <div class="form-group">
                        <label>Ph√≥ng to / Thu nh·ªè</label>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <button type="button" class="btn btn-secondary"
                                onclick="var s=document.getElementById('avatar-zoom'); s.value=Math.max(0.5, parseFloat(s.value)-0.1); s.dispatchEvent(new Event('input'));"
                                style="width:50px; height:50px; font-size:1.5rem; touch-action:manipulation;">
                                ‚àí
                            </button>
                            <input type="range" id="avatar-zoom" class="zoom-slider" min="0.5" max="3" step="0.1"
                                value="1" style="flex:1; touch-action:pan-x; height:40px;">
                            <button type="button" class="btn btn-secondary"
                                onclick="var s=document.getElementById('avatar-zoom'); s.value=Math.min(3, parseFloat(s.value)+0.1); s.dispatchEvent(new Event('input'));"
                                style="width:50px; height:50px; font-size:1.5rem; touch-action:manipulation;">
                                +
                            </button>
                        </div>
                    </div>
                    <div class="tip-box">
                        <i class="fa-solid fa-lightbulb"></i>
                        <strong>M·∫πo:</strong> D√πng n√∫t + / ‚àí ho·∫∑c k√©o ·∫£nh tr√™n khung xem tr∆∞·ªõc.
                    </div>
                </div>
            </div>

            <!-- C·ªôt xem tr∆∞·ªõc -->
            <div class="right-col">
                <div class="card preview-card">
                    <h3><i class="fa-solid fa-eye"></i> 3. Xem tr∆∞·ªõc & T·∫£i v·ªÅ</h3>
                    <div class="canvas-wrapper avatar-wrapper">
                        <canvas id="avatar-canvas" width="2000" height="2000"></canvas>
                    </div>
                    <button id="btn-avatar-download" class="btn btn-success btn-block" disabled>
                        <i class="fa-solid fa-download"></i> T·∫£i Avatar v·ªÅ m√°y
                    </button>
                    <button id="btn-avatar-reset" class="btn btn-secondary btn-block"
                        style="margin-top: 10px; display: none;">
                        <i class="fa-solid fa-rotate-left"></i> T·∫°o l·∫°i t·ª´ ƒë·∫ßu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer
        style="text-align: center; margin: 40px auto 20px; padding: 20px 30px; color: #00723F; font-size: 0.95rem; font-weight: 500; max-width: 1200px; background: white; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); border: 2px solid #00723F;">
        <p style="margin: 0;">Chi·∫øn d·ªãch Xu√¢n t√¨nh nguy·ªán Tr∆∞·ªùng ƒê·∫°i h·ªçc Kinh t·∫ø - Lu·∫≠t, ƒêHQG-HCM nƒÉm 2026</p>
    </footer>

    <!-- Firebase (ch·ªâ d√πng cho counter, kh√¥ng c·∫ßn ƒëƒÉng nh·∫≠p) -->
    <script type="module">
        import { db } from './js/firebase.js';
        import { doc, getDoc, setDoc, increment } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { initAvatarCanvas, handleAvatarUpload, resetAvatarFull } from './js/dashboard-avatar.js';

        // Counter document reference
        const counterRef = doc(db, 'xtn_settings', 'avatar_counter');

        // Load counter on page load
        async function loadCounter() {
            try {
                const counterDoc = await getDoc(counterRef);
                const count = counterDoc.exists() ? (counterDoc.data().count || 0) : 0;
                document.getElementById('counter-number').textContent = count.toLocaleString('vi-VN');
            } catch (e) {
                console.warn('[Avatar] Counter load failed:', e);
            }
        }

        // Increment counter on download
        async function incrementCounter() {
            try {
                await setDoc(counterRef, { count: increment(1) }, { merge: true });
                // Update UI immediately
                const el = document.getElementById('counter-number');
                const current = parseInt(el.textContent.replace(/\./g, '')) || 0;
                el.textContent = (current + 1).toLocaleString('vi-VN');
            } catch (e) {
                console.warn('[Avatar] Counter increment failed:', e);
            }
        }

        // HD Download with counter - h·ªó tr·ª£ mobile
        function downloadAvatarHD() {
            const canvas = document.getElementById('avatar-canvas');
            if (!canvas) return;

            const dataUrl = canvas.toDataURL('image/png', 1.0);

            // Ki·ªÉm tra c√≥ ph·∫£i mobile kh√¥ng
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            if (isMobile) {
                // Mobile: M·ªü ·∫£nh trong tab m·ªõi ƒë·ªÉ ng∆∞·ªùi d√πng nh·∫•n gi·ªØ v√† l∆∞u
                const newWindow = window.open('', '_blank');
                if (newWindow) {
                    newWindow.document.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <title>Avatar XTN 2026</title>
                            <style>
                                body { 
                                    margin: 0; 
                                    padding: 20px; 
                                    display: flex; 
                                    flex-direction: column;
                                    align-items: center; 
                                    justify-content: center; 
                                    min-height: 100vh; 
                                    background: #f5f5f5;
                                    font-family: sans-serif;
                                }
                                img { 
                                    max-width: 100%; 
                                    height: auto; 
                                    border-radius: 12px;
                                    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                                }
                                .instructions {
                                    text-align: center;
                                    margin-bottom: 20px;
                                    padding: 15px;
                                    background: #00723F;
                                    color: white;
                                    border-radius: 10px;
                                    font-size: 14px;
                                }
                                .instructions strong {
                                    display: block;
                                    font-size: 16px;
                                    margin-bottom: 8px;
                                }
                            </style>
                        </head>
                        <body>
                            <div class="instructions">
                                <strong>üì± H∆∞·ªõng d·∫´n l∆∞u ·∫£nh</strong>
                                Nh·∫•n gi·ªØ v√†o ·∫£nh b√™n d∆∞·ªõi ‚Üí Ch·ªçn "L∆∞u h√¨nh ·∫£nh"
                            </div>
                            <img src="${dataUrl}" alt="Avatar XTN 2026">
                        </body>
                        </html>
                    `);
                    newWindow.document.close();
                } else {
                    alert('Vui l√≤ng cho ph√©p popup ƒë·ªÉ t·∫£i ·∫£nh!');
                }
            } else {
                // Desktop: T·∫£i tr·ª±c ti·∫øp
                const link = document.createElement('a');
                link.download = 'AvatarXTN2026.png';
                link.href = dataUrl;
                link.click();
            }

            // Increment counter
            incrementCounter();
        }

        // Kh·ªüi t·∫°o tr·ª±c ti·∫øp - KH√îNG c·∫ßn ƒëƒÉng nh·∫≠p
        document.addEventListener('DOMContentLoaded', () => {
            // Init avatar canvas
            initAvatarCanvas();

            // Load counter
            loadCounter();

            // Event listeners
            document.getElementById('avatar-upload').addEventListener('change', handleAvatarUpload);
            document.getElementById('btn-avatar-download').addEventListener('click', downloadAvatarHD);
            document.getElementById('btn-avatar-reset').addEventListener('click', resetAvatarFull);
        });
    </script>
</body>

</html>