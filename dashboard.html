<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Xuân Tình Nguyện 2026</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'UTM Avo';
            src: url('fonts/UTM-Avo.woff2') format('woff2'),
                url('fonts/UTM-Avo.woff') format('woff'),
                url('fonts/UTM-Avo.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
    </style>

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- SheetJS for Excel Import/Export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- QR Code Styling for Card QR -->
    <script src="https://unpkg.com/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>

    <!-- SweetAlert2 for beautiful dialogs -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/activity.css">
</head>

<body>
    <div class="dashboard-wrapper">
        <!-- ===== SIDEBAR ===== -->
        <aside class="sidebar">
            <!-- User Info -->
            <div class="sidebar-user">
                <div class="user-avatar">
                    <img id="user-avatar-img" src="images/default-avatar.png" alt="Avatar">
                </div>
                <p class="user-greeting">Xin chào,</p>
                <h3 class="user-name" id="user-name">Đang tải...</h3>
            </div>

            <!-- Clock -->
            <div class="sidebar-clock">
                <div class="clock-time" id="clock-time">--:--:--</div>
                <div class="clock-date" id="clock-date">--/--/----</div>
            </div>

            <!-- Menu -->
            <nav class="sidebar-menu">
                <!-- Tổng quan - chỉ BCH -->
                <div class="menu-item active" id="menu-dashboard" data-section="section-dashboard">
                    <i class="fa-solid fa-chart-pie"></i> Tổng quan
                </div>


                <!-- Member+ -->
                <div class="menu-section" id="menu-tools">
                    <div class="menu-section-title">
                        <i class="fa-solid fa-toolbox"></i> Công cụ
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                    <div class="menu-submenu">
                        <div class="menu-item" data-section="section-avatar">
                            <i class="fa-solid fa-image"></i> Tạo Avatar
                        </div>
                        <div class="menu-item" data-section="section-card">
                            <i class="fa-solid fa-id-card"></i> Tạo Thẻ Chiến sĩ
                        </div>
                    </div>
                </div>

                <!-- BCH Đội+ -->
                <div class="menu-item" id="menu-activity" data-section="section-activity">
                    <i class="fa-solid fa-calendar-check"></i> Quản lý Hoạt động
                </div>

                <!-- Super Admin -->
                <div class="menu-section" id="menu-system">
                    <div class="menu-section-title">
                        <i class="fa-solid fa-users-gear"></i> Quản lý Chiến sĩ
                        <i class="fa-solid fa-chevron-down"></i>
                    </div>
                    <div class="menu-submenu">

                        <div class="menu-item" data-section="section-members">
                            <i class="fa-solid fa-users"></i> Danh sách Chiến sĩ
                        </div>
                        <div class="menu-item" data-section="section-cards-admin">
                            <i class="fa-solid fa-id-card"></i> Quản trị Thẻ
                        </div>
                        <div class="menu-item" data-section="section-teams">
                            <i class="fa-solid fa-people-group"></i> Đội hình
                        </div>

                        <div class="menu-item" data-section="section-settings">
                            <i class="fa-solid fa-gear"></i> Cài đặt
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Logout -->
            <div class="sidebar-footer">
                <button id="btn-logout" class="btn-logout">
                    <i class="fa-solid fa-right-from-bracket"></i> Đăng xuất
                </button>
            </div>
        </aside>

        <!-- ===== MAIN CONTENT ===== -->
        <main class="main-content">
            <!-- Section: Loading -->
            <section id="section-loading" class="section active">
                <div class="loading-container">
                    <i class="fa-solid fa-circle-notch fa-spin fa-3x"></i>
                    <p>Đang tải dữ liệu...</p>
                </div>
            </section>

            <!-- Section: Dashboard/Tổng quan -->
            <section id="section-dashboard" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-chart-pie"></i> Tổng quan</h1>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fa-solid fa-users"></i>
                        <h3 id="stat-members">0</h3>
                        <p>Chiến sĩ</p>
                    </div>
                    <div class="stat-card">
                        <i class="fa-solid fa-user-clock"></i>
                        <h3 id="stat-pending">0</h3>
                        <p>Chờ duyệt</p>
                    </div>
                    <div class="stat-card">
                        <i class="fa-solid fa-people-group"></i>
                        <h3 id="stat-teams">0</h3>
                        <p>Đội hình</p>
                    </div>
                    <div class="stat-card">
                        <i class="fa-solid fa-calendar-check"></i>
                        <h3 id="stat-activities">0</h3>
                        <p>Hoạt động</p>
                    </div>
                </div>

                <!-- AI Insights Widget -->
                <div class="card ai-insights-card" id="ai-insights-widget" style="margin-top: 20px;">
                    <div class="ai-insights-header">
                        <h3><i class="fa-solid fa-robot"></i> AI Insights</h3>
                        <button id="btn-refresh-insights" class="btn btn-sm btn-secondary" title="Làm mới">
                            <i class="fa-solid fa-sync-alt"></i>
                        </button>
                    </div>
                    <div id="ai-insights-content" class="ai-insights-content">
                        <div class="ai-loading">
                            <i class="fa-solid fa-circle-notch fa-spin"></i>
                            <span>Đang phân tích dữ liệu...</span>
                        </div>
                    </div>
                    <div class="ai-insights-actions" style="margin-top: 15px; display: none;" id="ai-insights-actions">
                        <button id="btn-ai-detail-report" class="btn btn-sm btn-primary">
                            <i class="fa-solid fa-file-alt"></i> Tạo báo cáo chi tiết
                        </button>
                        <button id="btn-ai-team-analysis" class="btn btn-sm btn-secondary" style="margin-left: 10px;">
                            <i class="fa-solid fa-users-gear"></i> AI Phân tích Đội
                        </button>
                    </div>
                </div>

                <!-- AI Team Analysis Modal -->
                <div id="modal-team-analysis" class="modal" style="display: none;">
                    <div class="modal-content" style="max-width: 700px;">
                        <div class="modal-header"
                            style="background: linear-gradient(135deg, #8b5cf6, #6d28d9); color: white;">
                            <h2><i class="fa-solid fa-users-gear"></i> AI Phân tích Đội hình</h2>
                            <button class="modal-close" onclick="closeTeamAnalysisModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Chọn đội hình để phân tích:</label>
                                <select id="select-team-analysis" class="form-control">
                                    <option value="">-- Chọn đội --</option>
                                </select>
                            </div>
                            <div id="team-analysis-result" style="display: none; margin-top: 20px;">
                                <div id="team-analysis-content" style="white-space: pre-wrap; line-height: 1.6;"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary"
                                onclick="closeTeamAnalysisModal()">Đóng</button>
                            <button type="button" id="btn-run-team-analysis" class="btn btn-primary"
                                onclick="runTeamAnalysis()">
                                <i class="fa-solid fa-wand-magic-sparkles"></i> Phân tích
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ĐÃ XÓA: Section Đăng ký Chiến sĩ và Section Chờ duyệt (chuyển sang Google Form) -->


            <!-- Section: Tạo Avatar -->
            <section id="section-avatar" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-image"></i> Tạo Avatar XTN 2026</h1>
                    <p>Tải ảnh chân dung lên, điều chỉnh và tải về avatar chiến dịch!</p>
                </div>

                <div class="two-column">
                    <!-- Cột điều khiển -->
                    <div class="left-col">
                        <div class="card">
                            <h3><i class="fa-solid fa-upload"></i> 1. Tải ảnh lên</h3>
                            <label class="upload-area" for="avatar-upload" id="avatar-upload-label">
                                <i class="fa-solid fa-cloud-arrow-up"></i>
                                <p>Nhấn hoặc kéo ảnh vào đây</p>
                                <small>Hỗ trợ: JPG, PNG, WEBP</small>
                            </label>
                            <input type="file" id="avatar-upload" accept="image/*" hidden>
                        </div>

                        <div class="card" style="margin-top: 15px;">
                            <h3><i class="fa-solid fa-sliders"></i> 2. Điều chỉnh</h3>
                            <div class="form-group">
                                <label for="avatar-zoom">Phóng to / Thu nhỏ</label>
                                <input type="range" id="avatar-zoom" class="zoom-slider" min="0.5" max="3" step="0.01"
                                    value="1">
                            </div>
                            <div class="tip-box">
                                <i class="fa-solid fa-lightbulb"></i>
                                <strong>Mẹo:</strong> Dùng con lăn chuột hoặc kéo ảnh trên khung xem trước để điều
                                chỉnh.
                            </div>
                        </div>
                    </div>

                    <!-- Cột xem trước -->
                    <div class="right-col">
                        <div class="card preview-card">
                            <h3><i class="fa-solid fa-eye"></i> 3. Xem trước & Tải về</h3>
                            <div class="canvas-wrapper avatar-wrapper">
                                <canvas id="avatar-canvas" width="1000" height="1000"></canvas>
                            </div>
                            <button id="btn-avatar-download" class="btn btn-success btn-block" disabled>
                                <i class="fa-solid fa-download"></i> Tải Avatar về máy
                            </button>
                            <button id="btn-avatar-reset" class="btn btn-secondary btn-block"
                                style="margin-top: 10px; display: none;">
                                <i class="fa-solid fa-rotate-left"></i> Tạo lại từ đầu
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Tạo Thẻ Chiến sĩ -->
            <section id="section-card" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-id-card"></i> Tạo Thẻ Chiến sĩ XTN 2026</h1>
                    <p>Điền thông tin và tải ảnh để tạo thẻ chiến sĩ</p>
                </div>
                <div class="two-column">
                    <div class="left-col">
                        <div class="card">
                            <h3><i class="fa-solid fa-file-pen"></i> Nhập thông tin</h3>
                            <form id="card-form">
                                <div class="form-group">
                                    <label>Họ và tên <span class="required">*</span></label>
                                    <input type="text" id="card-name" placeholder="Nguyễn Văn A" required>
                                </div>
                                <div class="form-group">
                                    <label>MSSV / MSCB</label>
                                    <input type="text" id="card-mssv" placeholder="Nhập mã số sinh viên">
                                </div>
                                <div class="form-group">
                                    <label>Vai trò <i class="fa-solid fa-lock" style="color:#888;"
                                            title="Tự động lấy từ hệ thống"></i></label>
                                    <input type="text" id="card-role" readonly class="readonly-field"
                                        placeholder="Chiến sĩ" title="Vai trò được gán từ hệ thống">
                                </div>
                                <div class="form-group">
                                    <label>Đội hình <i class="fa-solid fa-lock" style="color:#888;"
                                            title="Tự động lấy từ hệ thống"></i></label>
                                    <input type="text" id="card-team" readonly class="readonly-field"
                                        placeholder="Chưa phân đội" title="Đội hình được gán từ hệ thống">
                                </div>
                                <div class="form-group">
                                    <label>Ảnh chân dung</label>
                                    <label class="upload-area" for="card-photo" id="card-photo-label">
                                        <i class="fa-solid fa-cloud-arrow-up"></i>
                                        <p>Nhấn hoặc kéo ảnh vào đây</p>
                                        <small>Hỗ trợ: JPG, PNG</small>
                                    </label>
                                    <input type="file" id="card-photo" accept="image/*" hidden>
                                </div>
                                <div class="form-group" id="card-zoom-group" style="display:none;">
                                    <label>Phóng to / Thu nhỏ</label>
                                    <input type="range" id="card-zoom" class="zoom-slider" min="0.5" max="3" step="0.01"
                                        value="1">
                                    <div class="tip-box">
                                        <i class="fa-solid fa-lightbulb"></i>
                                        <strong>Mẹo:</strong> Dùng con lăn chuột hoặc kéo ảnh trên khung xem trước.
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary btn-block">
                                    <i class="fa-solid fa-rotate"></i> Cập nhật thẻ
                                </button>
                            </form>
                        </div>

                        <!-- Thẻ Cấp Thành phố -->
                        <div class="card" style="margin-top:20px;">
                            <h3><i class="fa-solid fa-city"></i> Thẻ Cấp Thành phố</h3>
                            <p style="color:#666; font-size:0.9rem; margin-bottom:15px;">
                                Nếu bạn có thẻ cấp thành phố, hãy nhập link Google Drive bên dưới.
                            </p>
                            <div class="form-group">
                                <label>Link Drive Thẻ Thành phố</label>
                                <input type="url" id="card-city-link" placeholder="https://drive.google.com/file/d/..."
                                    class="form-control">
                            </div>
                            <button type="button" id="btn-save-city-card" class="btn btn-secondary btn-block">
                                <i class="fa-solid fa-save"></i> Lưu Link Thẻ
                            </button>
                        </div>
                    </div>
                    <div class="right-col">
                        <div class="card preview-card">
                            <h3><i class="fa-solid fa-eye"></i> Xem trước thẻ</h3>
                            <div class="canvas-wrapper card-wrapper">
                                <canvas id="card-canvas" width="1100" height="1700"></canvas>
                            </div>
                            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                                <button id="btn-card-download" class="btn btn-success" style="flex:1;" disabled>
                                    <i class="fa-solid fa-download"></i> Tải về
                                </button>
                                <button id="btn-card-confirm" class="btn btn-primary" style="flex:1;" disabled>
                                    <i class="fa-solid fa-check-circle"></i> Đã tạo thẻ
                                </button>
                            </div>
                            <div id="card-confirm-status" style="margin-top:10px; text-align:center;"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Quản lý Hoạt động -->
            <section id="section-activities" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-calendar-check"></i> Quản lý Hoạt động</h1>
                </div>

                <!-- AI Toolbar - TẠM TẮT, LÀM SAU
                <div class="card"
                    style="margin-bottom:15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white;">
                    <div style="display:flex; align-items:center; gap:15px; flex-wrap:wrap;">
                        <div style="flex:1;">
                            <h3 style="margin:0; display:flex; align-items:center; gap:8px;">
                                <i class="fa-solid fa-robot"></i> AI Assistant
                            </h3>
                            <p style="margin:5px 0 0; opacity:0.9; font-size:14px;">Sử dụng AI để tạo hoạt động và báo
                                cáo nhanh chóng</p>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button id="btn-ai-create-activity" class="btn"
                                style="background:rgba(255,255,255,0.2); color:white; border:1px solid rgba(255,255,255,0.3);">
                                <i class="fa-solid fa-wand-magic-sparkles"></i> Tạo hoạt động AI
                            </button>
                            <button id="btn-ai-report" class="btn"
                                style="background:rgba(255,255,255,0.2); color:white; border:1px solid rgba(255,255,255,0.3);">
                                <i class="fa-solid fa-file-lines"></i> Báo cáo AI
                            </button>
                        </div>
                    </div>
                </div>
                -->

                <div class="card">
                    <div id="activities-list">
                        <p style="text-align:center;color:#888;">Đang tải danh sách hoạt động...</p>
                    </div>
                </div>
            </section>

            <!-- Modal AI Create Activity -->
            <div id="modal-ai-activity" class="modal-overlay" style="display:none;">
                <div class="modal-content modal-lg">
                    <button class="modal-close" onclick="closeAIActivityModal()">&times;</button>
                    <h2><i class="fa-solid fa-wand-magic-sparkles"></i> AI Tạo Hoạt động</h2>
                    <p style="color:#666;">Mô tả hoạt động bằng ngôn ngữ tự nhiên, AI sẽ tự động điền form cho bạn.</p>

                    <div class="form-group">
                        <label>Mô tả hoạt động:</label>
                        <textarea id="ai-activity-input" rows="4"
                            placeholder="VD: Tổ chức dọn vệ sinh công viên Tao Đàn vào sáng thứ 7 ngày 15/1/2025, dự kiến 50 sinh viên tham gia, địa điểm tập trung là cổng chính..."></textarea>
                    </div>

                    <div id="ai-activity-result" style="display:none;">
                        <h4>Kết quả AI:</h4>
                        <div id="ai-activity-preview" class="card" style="background:#f8f9fa;"></div>
                    </div>

                    <div class="modal-actions" style="margin-top:20px;">
                        <button class="btn btn-secondary" onclick="closeAIActivityModal()">Đóng</button>
                        <button id="btn-ai-generate" class="btn btn-primary">
                            <i class="fa-solid fa-sparkles"></i> Tạo với AI
                        </button>
                        <button id="btn-ai-apply" class="btn btn-success" style="display:none;">
                            <i class="fa-solid fa-check"></i> Áp dụng vào Form
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal AI Report -->
            <div id="modal-ai-report" class="modal-overlay" style="display:none;">
                <div class="modal-content modal-lg">
                    <button class="modal-close" onclick="closeAIReportModal()">&times;</button>
                    <h2><i class="fa-solid fa-file-lines"></i> AI Tạo Báo cáo</h2>

                    <div class="form-row" style="margin-bottom:15px;">
                        <div class="form-group">
                            <label>Loại báo cáo:</label>
                            <select id="ai-report-type">
                                <option value="summary">Tóm tắt</option>
                                <option value="detailed">Chi tiết</option>
                                <option value="statistics">Thống kê</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Phạm vi:</label>
                            <select id="ai-report-range">
                                <option value="all">Toàn bộ</option>
                                <option value="week">Tuần này</option>
                                <option value="month">Tháng này</option>
                            </select>
                        </div>
                    </div>

                    <button id="btn-ai-generate-report" class="btn btn-primary" style="margin-bottom:15px;">
                        <i class="fa-solid fa-sparkles"></i> Tạo Báo cáo
                    </button>

                    <div id="ai-report-result" style="display:none;">
                        <h4>Báo cáo:</h4>
                        <div id="ai-report-content" class="card"
                            style="background:#f8f9fa; max-height:400px; overflow-y:auto; white-space:pre-wrap;"></div>
                        <button id="btn-copy-report" class="btn btn-secondary" style="margin-top:10px;">
                            <i class="fa-solid fa-copy"></i> Copy nội dung
                        </button>
                    </div>
                </div>
            </div>

            <!-- Section: Thêm hoạt động -->
            <section id="section-add-activity" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-plus"></i> Thêm hoạt động mới</h1>
                </div>
                <div class="card" style="max-width:600px;">
                    <form id="activity-form">
                        <div class="form-group">
                            <label>Tên hoạt động</label>
                            <input type="text" id="act-name" required placeholder="VD: Dọn vệ sinh công viên">
                        </div>
                        <div class="form-group">
                            <label>Ngày thực hiện</label>
                            <input type="date" id="act-date" required>
                        </div>
                        <div class="form-group">
                            <label>Số người tham gia</label>
                            <input type="number" id="act-participants" required placeholder="20">
                        </div>
                        <div class="form-group">
                            <label>Mô tả</label>
                            <textarea id="act-desc" rows="3" placeholder="Mô tả hoạt động..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary btn-block">
                            <i class="fa-solid fa-save"></i> Lưu hoạt động
                        </button>
                    </form>
                </div>
            </section>

            <!-- Section: Đơn đăng ký (Admin) -->
            <section id="section-registrations" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-user-clock"></i> Đơn đăng ký</h1>
                    <p>Xem chi tiết và duyệt đơn đăng ký chiến sĩ.</p>
                </div>

                <!-- Filter -->
                <div class="card" style="margin-bottom:15px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Lọc theo đội</label>
                            <select id="reg-filter-team" onchange="loadRegistrations()">
                                <option value="">-- Tất cả đội --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Lọc theo trạng thái</label>
                            <select id="reg-filter-status" onchange="loadRegistrations()">
                                <option value="">-- Tất cả --</option>
                                <option value="pending">Chờ duyệt</option>
                                <option value="pass">Đạt</option>
                                <option value="consider">Xem xét</option>
                                <option value="fail">Rớt</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="btn-row" style="margin-bottom:15px;">
                        <button id="btn-delete-regs" class="btn-danger" onclick="deleteSelectedRegs()" disabled>
                            <i class="fa-solid fa-trash"></i> Xóa đã chọn (<span id="regs-selected-count">0</span>)
                        </button>
                    </div>
                    <div id="registrations-list">
                        <p style="text-align:center;color:#888;">Đang tải...</p>
                    </div>
                </div>
            </section>

            <!-- Modal Chi tiết Đơn đăng ký -->
            <div id="modal-registration" class="modal-overlay" style="display:none;">
                <div class="modal-content modal-lg">
                    <button class="modal-close" onclick="closeRegistrationModal()">&times;</button>
                    <h2><i class="fa-solid fa-file-alt"></i> Chi tiết đơn đăng ký</h2>
                    <div id="modal-registration-content"></div>
                </div>
            </div>

            <!-- Section: Danh sách Chiến sĩ (Admin) -->
            <section id="section-members" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-users"></i> Danh sách Chiến sĩ</h1>
                </div>

                <!-- Excel Toolbar -->
                <div class="card" style="margin-bottom:15px;">
                    <div class="btn-row" style="gap:10px; flex-wrap:wrap;">
                        <button id="btn-add-member" class="btn btn-primary">
                            <i class="fa-solid fa-user-plus"></i> Thêm chiến sĩ
                        </button>
                        <button id="btn-export-excel" class="btn btn-success">
                            <i class="fa-solid fa-file-excel"></i> Xuất Excel
                        </button>
                        <button id="btn-import-excel" class="btn btn-warning">
                            <i class="fa-solid fa-upload"></i> Nhập từ Excel
                        </button>
                        <button id="btn-download-template" class="btn btn-info">
                            <i class="fa-solid fa-download"></i> Tải mẫu Import
                        </button>
                        <input type="file" id="excel-import-file" accept=".xlsx,.xls" style="display:none;">
                    </div>
                </div>

                <div class="card">
                    <div id="members-list">
                        <p style="text-align:center;color:#888;">Đang tải...</p>
                    </div>
                </div>
            </section>

            <!-- Modal Import Preview -->
            <div id="modal-import-preview" class="modal-overlay" style="display:none;">
                <div class="modal-content modal-lg">
                    <button class="modal-close" onclick="closeImportPreview()">&times;</button>
                    <h2><i class="fa-solid fa-file-import"></i> Xem trước dữ liệu Import</h2>
                    <div id="import-preview-content"></div>
                    <div class="modal-actions" style="margin-top:20px;">
                        <button class="btn btn-secondary" onclick="closeImportPreview()">Hủy</button>
                        <button id="btn-confirm-import" class="btn btn-primary">
                            <i class="fa-solid fa-check"></i> Xác nhận Import
                        </button>
                    </div>
                </div>
            </div>

            <!-- Modal Add Member Manually -->
            <div id="modal-add-member" class="modal-overlay" style="display:none;">
                <div class="modal-content" style="max-width:500px;">
                    <button class="modal-close" onclick="closeAddMemberModal()">&times;</button>
                    <h2><i class="fa-solid fa-user-plus"></i> Thêm Chiến sĩ mới</h2>
                    <form id="form-add-member">
                        <div class="form-group">
                            <label>Họ và tên <span class="required">*</span></label>
                            <input type="text" id="new-member-name" required placeholder="Nguyễn Văn A">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>MSSV</label>
                                <input type="text" id="new-member-mssv" placeholder="K21000001">
                            </div>
                            <div class="form-group">
                                <label>Email <span class="required">*</span></label>
                                <input type="email" id="new-member-email" required placeholder="abc@st.uel.edu.vn">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Số điện thoại</label>
                                <input type="tel" id="new-member-phone" placeholder="0901234567">
                            </div>
                            <div class="form-group">
                                <label>Đội hình <span class="required">*</span></label>
                                <select id="new-member-team" required>
                                    <option value="">-- Chọn đội hình --</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Vai trò</label>
                            <select id="new-member-role">
                                <option value="member">Chiến sĩ</option>
                                <option value="doihinh_admin">BCH Đội (Đội trưởng/Đội phó)</option>
                                <option value="kysutet_admin">Đội trưởng/Đội phó Ký sự Tết</option>
                                <option value="super_admin">BCH Trường (Super Admin)</option>
                                <option value="pending">Chờ duyệt</option>
                            </select>
                        </div>
                        <div class="modal-actions" style="margin-top:20px;">
                            <button type="button" class="btn btn-secondary" onclick="closeAddMemberModal()">Hủy</button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fa-solid fa-plus"></i> Thêm chiến sĩ
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Section: Đội hình (Admin) -->
            <section id="section-teams" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-people-group"></i> Quản lý Đội hình</h1>
                    <p>Thêm, sửa, xóa các đội hình. Dữ liệu sẽ hiển thị trong form đăng ký.</p>
                </div>

                <!-- Form thêm/sửa đội -->
                <div class="card" style="margin-bottom:20px;">
                    <h3 id="team-form-title"><i class="fa-solid fa-plus"></i> Thêm đội mới</h3>
                    <form id="team-form">
                        <input type="hidden" id="team-edit-id">

                        <div class="form-group">
                            <label>Tên đội <span class="required">*</span></label>
                            <input type="text" id="team-name" required placeholder="Đội 1 - Sức Khỏe">
                        </div>

                        <h4 style="margin:15px 0 10px;color:#dc2626;"><i class="fa-solid fa-user-tie"></i> Ban Chỉ huy
                            Đội</h4>

                        <!-- Đội trưởng -->
                        <div class="bch-member">
                            <label class="bch-label">Đội trưởng</label>
                            <div class="form-row">
                                <div class="form-group">
                                    <input type="text" id="team-captain-name" placeholder="Họ và tên">
                                </div>
                                <div class="form-group">
                                    <input type="email" id="team-captain-email" placeholder="Email">
                                </div>
                            </div>
                        </div>

                        <!-- Đội phó 1 -->
                        <div class="bch-member">
                            <label class="bch-label">Đội phó 1</label>
                            <div class="form-row">
                                <div class="form-group">
                                    <input type="text" id="team-vice1-name" placeholder="Họ và tên">
                                </div>
                                <div class="form-group">
                                    <input type="email" id="team-vice1-email" placeholder="Email">
                                </div>
                            </div>
                        </div>

                        <!-- Đội phó 2 -->
                        <div class="bch-member">
                            <label class="bch-label">Đội phó 2</label>
                            <div class="form-row">
                                <div class="form-group">
                                    <input type="text" id="team-vice2-name" placeholder="Họ và tên">
                                </div>
                                <div class="form-group">
                                    <input type="email" id="team-vice2-email" placeholder="Email">
                                </div>
                            </div>
                        </div>

                        <!-- Container cho đội phó thêm -->
                        <div id="extra-vice-container"></div>

                        <button type="button" class="btn btn-sm btn-secondary" onclick="addExtraVice()"
                            style="margin-bottom:15px;">
                            <i class="fa-solid fa-plus"></i> Thêm đội phó
                        </button>

                        <div class="btn-row">
                            <button type="submit" class="btn btn-primary">
                                <i class="fa-solid fa-save"></i> Lưu đội
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetTeamForm()">
                                <i class="fa-solid fa-rotate-left"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Danh sách đội -->
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                        <h3 style="margin:0;"><i class="fa-solid fa-list"></i> Danh sách đội hình</h3>
                        <button class="btn btn-danger btn-sm" onclick="deleteSelectedTeams()" id="btn-delete-teams"
                            disabled>
                            <i class="fa-solid fa-trash"></i> Xóa đã chọn (<span id="teams-selected-count">0</span>)
                        </button>
                    </div>
                    <div id="teams-list">
                        <p style="text-align:center;color:#888;">Đang tải...</p>
                    </div>
                </div>
            </section>

            <!-- Section: Quản lý Câu hỏi (Admin) -->
            <section id="section-questions" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-circle-question"></i> Quản lý Câu hỏi</h1>
                    <p>Thêm câu hỏi riêng cho từng đội hình hoặc câu hỏi chung cho tất cả.</p>
                </div>

                <!-- Form thêm/sửa câu hỏi -->
                <div class="card" style="margin-bottom:20px;">
                    <h3 id="question-form-title"><i class="fa-solid fa-plus"></i> Thêm câu hỏi mới</h3>
                    <form id="question-form">
                        <input type="hidden" id="q-edit-id">

                        <div class="form-group">
                            <label>Nội dung câu hỏi <span class="required">*</span></label>
                            <input type="text" id="q-content" required
                                placeholder="VD: Bạn có thể tham gia tập huấn không?">
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Dành cho đội</label>
                                <select id="q-team">
                                    <option value="">-- Tất cả đội (Câu hỏi chung) --</option>
                                    <!-- Load từ xtn_teams -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Bắt buộc trả lời?</label>
                                <select id="q-required">
                                    <option value="false">Không bắt buộc</option>
                                    <option value="true">Bắt buộc</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Thứ tự</label>
                                <input type="number" id="q-order" value="1" min="1">
                            </div>
                        </div>

                        <div class="btn-row">
                            <button type="submit" class="btn btn-primary">
                                <i class="fa-solid fa-save"></i> Lưu câu hỏi
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="resetQuestionForm()">
                                <i class="fa-solid fa-rotate-left"></i> Reset
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Danh sách câu hỏi -->
                <div class="card">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                        <h3 style="margin:0;"><i class="fa-solid fa-list"></i> Danh sách câu hỏi</h3>
                        <button class="btn btn-danger btn-sm" onclick="deleteSelectedQuestions()"
                            id="btn-delete-questions" disabled>
                            <i class="fa-solid fa-trash"></i> Xóa đã chọn (<span id="questions-selected-count">0</span>)
                        </button>
                    </div>
                    <div id="questions-list">
                        <p style="text-align:center;color:#888;">Đang tải...</p>
                    </div>
                </div>
            </section>

            <!-- Section: Quản trị Thẻ (Admin) -->
            <section id="section-cards-admin" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-id-card"></i> Quản trị Thẻ Chiến sĩ</h1>
                    <p>Xem và quản lý thẻ chiến sĩ đã tạo</p>
                </div>

                <!-- View Tabs -->
                <div class="cards-admin-tabs">
                    <button class="cards-tab active" data-view="grid">
                        <i class="fa-solid fa-grip"></i> Dạng Lưới
                    </button>
                    <button class="cards-tab" data-view="table">
                        <i class="fa-solid fa-table"></i> Dạng Bảng
                    </button>
                </div>

                <!-- Toolbar -->
                <div class="card" style="margin-bottom:15px;">
                    <div class="form-row" style="align-items:center;">
                        <div class="form-group" style="flex:1;">
                            <input type="text" id="cards-search" placeholder="Tìm theo tên, MSSV, đội hình...">
                        </div>
                        <div class="form-group">
                            <select id="cards-filter-team">
                                <option value="">-- Tất cả đội --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select id="cards-filter-status">
                                <option value="">-- Thẻ Chiến sĩ --</option>
                                <option value="created">Đã tạo thẻ</option>
                                <option value="not-created">Chưa tạo thẻ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <select id="cards-filter-city">
                                <option value="">-- Thẻ Cấp Thành --</option>
                                <option value="has-city">Có Thẻ Cấp Thành</option>
                                <option value="no-city">Chưa có Thẻ Cấp Thành</option>
                            </select>
                        </div>
                        <button id="btn-export-cards" class="btn btn-success">
                            <i class="fa-solid fa-file-excel"></i> Xuất Excel
                        </button>
                    </div>
                </div>

                <!-- Grid View -->
                <div id="cards-grid-view" class="cards-view active">
                    <div class="cards-grid" id="cards-grid-container">
                        <p style="text-align:center;color:#888;grid-column:1/-1;">Đang tải...</p>
                    </div>
                </div>

                <!-- Table View -->
                <div id="cards-table-view" class="cards-view">
                    <div class="card">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Họ và Tên</th>
                                    <th>MSSV</th>
                                    <th>Đội hình</th>
                                    <th>Thẻ Chiến sĩ</th>
                                    <th>Thẻ Cấp Thành</th>
                                    <th>Thời gian tạo</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody id="cards-table-body">
                                <tr>
                                    <td colspan="8" style="text-align:center;color:#888;">Đang tải...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pagination -->
                <div class="cards-pagination" style="margin-top:15px;text-align:center;">
                    <button id="cards-prev-page" class="btn btn-sm" disabled>&laquo; Trước</button>
                    <span id="cards-page-info" style="margin:0 15px;">Trang 1 / 1</span>
                    <button id="cards-next-page" class="btn btn-sm">Sau &raquo;</button>
                </div>
            </section>

            <!-- Section: Quản lý Hoạt động (tương tự MHX) -->
            <section id="section-activity" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-calendar-check"></i> Quản lý Hoạt động</h1>
                    <p>Thời gian chiến dịch: <strong>15/12/2025 - 15/02/2026</strong></p>
                </div>

                <!-- Tab Navigation -->
                <div class="activity-tabs">
                    <button class="activity-tab active" data-tab="calendar">
                        <i class="fa-solid fa-calendar-days"></i> Lịch hoạt động
                    </button>
                    <button class="activity-tab" data-tab="stats">
                        <i class="fa-solid fa-chart-bar"></i> Thống kê
                    </button>
                    <button class="activity-tab" data-tab="report">
                        <i class="fa-solid fa-file-alt"></i> Báo cáo
                    </button>
                    <button class="activity-tab" data-tab="history">
                        <i class="fa-solid fa-clock-rotate-left"></i> Lịch sử
                    </button>
                </div>

                <!-- Tab Content: Calendar -->
                <div class="activity-tab-content active" id="tab-calendar">
                    <div class="calendar-toolbar">
                        <div class="calendar-nav">
                            <button id="btn-prev-week" class="btn btn-sm">
                                <i class="fa-solid fa-chevron-left"></i>
                            </button>
                            <span id="calendar-week-label">Tuần 1 (15/12 - 21/12)</span>
                            <button id="btn-next-week" class="btn btn-sm">
                                <i class="fa-solid fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="calendar-actions">
                            <button id="btn-add-activity" class="btn btn-primary">
                                <i class="fa-solid fa-plus"></i> Thêm hoạt động
                            </button>
                        </div>
                    </div>
                    <div class="calendar-wrapper">
                        <div class="calendar-grid" id="calendar-grid">
                            <!-- Generated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Stats -->
                <div class="activity-tab-content" id="tab-stats">
                    <div class="stats-toolbar">
                        <div class="stats-filters">
                            <select id="stats-team-filter">
                                <option value="">Tất cả đội hình</option>
                            </select>
                            <input type="date" id="stats-date-from" placeholder="Từ ngày">
                            <input type="date" id="stats-date-to" placeholder="Đến ngày">
                            <button id="btn-stats-filter" class="btn btn-sm">
                                <i class="fa-solid fa-filter"></i> Lọc
                            </button>
                        </div>
                        <button id="btn-export-csv" class="btn btn-success btn-sm">
                            <i class="fa-solid fa-file-csv"></i> Xuất CSV
                        </button>
                    </div>
                    <div class="stats-summary">
                        <div class="stat-card mini">
                            <h3 id="stats-total">0</h3>
                            <p>Tổng hoạt động</p>
                        </div>
                        <div class="stat-card mini">
                            <h3 id="stats-hours">0</h3>
                            <p>Giờ hoạt động</p>
                        </div>
                        <div class="stat-card mini">
                            <h3 id="stats-teams">0</h3>
                            <p>Đội tham gia</p>
                        </div>
                    </div>
                    <div class="card">
                        <table class="data-table" id="stats-table">
                            <thead>
                                <tr>
                                    <th>STT</th>
                                    <th>Ngày</th>
                                    <th>Thời gian</th>
                                    <th>Đội hình</th>
                                    <th>Địa điểm</th>
                                    <th>Nội dung</th>
                                    <th>Đề xuất BCH</th>
                                    <th>TG Cập nhật</th>
                                    <th>Người cập nhật</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="stats-tbody">
                                <!-- Generated by JS -->
                            </tbody>
                        </table>
                        <div class="table-pagination" id="stats-pagination"></div>
                    </div>
                </div>

                <!-- Tab Content: Report -->
                <div class="activity-tab-content" id="tab-report">
                    <!-- Export Report Section -->
                    <div class="export-report-section">
                        <h4><i class="fa-solid fa-file-export"></i> Xuất Báo cáo Tổng hợp</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Từ ngày</label>
                                <input type="date" id="export-date-from">
                            </div>
                            <div class="form-group">
                                <label>Đến ngày</label>
                                <input type="date" id="export-date-to">
                            </div>
                            <div class="form-group">
                                <label>Chọn Đội hình</label>
                                <select id="export-team-select">
                                    <option value="">Tất cả Đội hình</option>
                                </select>
                            </div>
                            <button id="btn-export-report" class="btn btn-success">
                                <i class="fa-solid fa-download"></i> Xuất File
                            </button>
                        </div>
                    </div>

                    <!-- Report Toolbar -->
                    <div class="report-toolbar"
                        style="display:flex; gap:15px; margin-bottom:20px; flex-wrap:wrap; align-items:center;">
                        <input type="text" id="report-search" placeholder="Tìm theo đội hình, nội dung..."
                            style="flex:1; min-width:200px;">
                        <input type="date" id="report-date-filter" placeholder="Tìm theo ngày">
                        <select id="report-team-select" style="min-width:150px;">
                            <option value="">Tất cả Đội hình</option>
                        </select>
                        <button id="btn-new-report" class="btn btn-success">
                            <i class="fa-solid fa-plus"></i> Thêm báo cáo mới
                        </button>
                        <button id="btn-ai-auto-report" class="btn btn-primary"
                            title="AI tự động tạo báo cáo từ dữ liệu hoạt động">
                            <i class="fa-solid fa-robot"></i> AI Tạo báo cáo
                        </button>
                    </div>

                    <!-- Reports List -->
                    <div class="reports-list" id="reports-list">
                        <!-- Generated by JS -->
                        <div class="empty-state">
                            <i class="fa-solid fa-file-circle-question fa-3x"></i>
                            <p>Chưa có báo cáo nào. Chọn đội hình và nhấn "Thêm báo cáo mới".</p>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: History -->
                <div class="activity-tab-content" id="tab-history">
                    <div class="history-toolbar">
                        <input type="text" id="history-search" placeholder="Tìm kiếm...">
                        <select id="history-action-filter">
                            <option value="">Tất cả hành động</option>
                            <option value="create">Tạo mới</option>
                            <option value="update">Cập nhật</option>
                            <option value="delete">Xóa</option>
                        </select>
                    </div>
                    <div class="history-list" id="history-list">
                        <!-- Generated by JS -->
                        <div class="empty-state">
                            <i class="fa-solid fa-clock-rotate-left fa-3x"></i>
                            <p>Chưa có lịch sử thay đổi.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section: Cài đặt (Super Admin only) -->
            <section id="section-settings" class="section">
                <div class="section-header">
                    <h1><i class="fa-solid fa-gear"></i> Cài đặt hệ thống</h1>
                    <p>Chỉ dành cho Ban Chỉ huy cấp Trường</p>
                </div>

                <div class="card">
                    <h3><i class="fa-solid fa-database"></i> Sao lưu dữ liệu (JSON)</h3>
                    <p style="color:#666; margin-bottom:20px;">Tải toàn bộ dữ liệu về máy dưới dạng JSON để backup. Bao
                        gồm: Thành viên, Đội hình, Hoạt động, Báo cáo, Thẻ chiến sĩ, Đăng ký.</p>

                    <div class="btn-row" style="gap:10px; flex-wrap:wrap;">
                        <button id="btn-backup-all-json" class="btn btn-primary">
                            <i class="fa-solid fa-download"></i> Tải toàn bộ (JSON)
                        </button>
                        <button id="btn-backup-users-json" class="btn btn-secondary">
                            <i class="fa-solid fa-users"></i> Chỉ thành viên
                        </button>
                        <button id="btn-backup-activities-json" class="btn btn-secondary">
                            <i class="fa-solid fa-calendar"></i> Chỉ hoạt động
                        </button>
                    </div>
                </div>

                <div class="card" style="margin-top:20px;">
                    <h3><i class="fa-solid fa-file-excel" style="color:#22c55e;"></i> Sao lưu dữ liệu (Excel)</h3>
                    <p style="color:#666; margin-bottom:20px;">Tải dữ liệu về máy dưới dạng file Excel để dễ dàng xem và
                        chỉnh sửa.</p>

                    <div class="btn-row" style="gap:10px; flex-wrap:wrap;">
                        <button id="btn-backup-all-excel" class="btn btn-success">
                            <i class="fa-solid fa-file-excel"></i> Tải toàn bộ (Excel)
                        </button>
                        <button id="btn-backup-users-excel" class="btn btn-secondary">
                            <i class="fa-solid fa-users"></i> Chỉ thành viên
                        </button>
                        <button id="btn-backup-activities-excel" class="btn btn-secondary">
                            <i class="fa-solid fa-calendar"></i> Chỉ hoạt động
                        </button>
                    </div>
                </div>


                <div class="card" style="margin-top:20px;">
                    <h3><i class="fa-solid fa-exclamation-triangle" style="color:#dc2626;"></i> Vùng nguy hiểm</h3>
                    <p style="color:#666; margin-bottom:20px;">Các thao tác không thể hoàn tác. Cân nhắc kỹ trước khi
                        thực hiện.</p>

                    <button id="btn-clear-activities" class="btn btn-danger" style="opacity:0.7;">
                        <i class="fa-solid fa-trash"></i> Xóa toàn bộ hoạt động
                    </button>
                </div>
            </section>
        </main>
    </div>


    <!-- Modal Xác nhận & Thông báo tùy chỉnh -->
    <div id="modal-confirm" class="modal-overlay" style="display:none;">
        <div class="modal-content modal-sm">
            <h3 id="modal-confirm-title"><i class="fa-solid fa-question-circle"></i> Xác nhận</h3>
            <p id="modal-confirm-message">Bạn có chắc chắn?</p>
            <div class="modal-actions">
                <button id="modal-confirm-cancel" class="btn btn-secondary">Hủy</button>
                <button id="modal-confirm-ok" class="btn btn-danger">Xác nhận</button>
            </div>
        </div>
    </div>

    <div id="modal-alert" class="modal-overlay" style="display:none;">
        <div class="modal-content modal-sm">
            <h3 id="modal-alert-title"><i class="fa-solid fa-info-circle"></i> Thông báo</h3>
            <p id="modal-alert-message">Thông báo...</p>
            <div class="modal-actions">
                <button id="modal-alert-ok" class="btn btn-primary">OK</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/dashboard-core.js"></script>
</body>

</html>